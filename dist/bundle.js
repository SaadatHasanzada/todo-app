(()=>{"use strict";const t=(t,e)=>{localStorage.setItem(t,JSON.stringify(e))},e=t=>{const e=localStorage.getItem(t);return e?JSON.parse(e):null};class s{constructor(){this.tasks=[{id:1,value:"Read a book",completed:!1},{id:2,value:"10 minutes meditation",completed:!0}],this.filter="all",this.listEl=document.getElementById("toDoList"),this.notFound=document.querySelector(".no-item-found"),this.inputEl=document.getElementById("todoInput"),this.allBtns=document.querySelectorAll("#all"),this.activeBtns=document.querySelectorAll("#active"),this.completedBtns=document.querySelectorAll("#completed"),this.filterButtons=document.querySelectorAll(".filter-btn"),this.itemsLeftElement=document.querySelector(".left-items"),this.clearCompleteditemsBtn=document.querySelector(".clear-completed-items"),this.inputEl.addEventListener("keyup",(t=>{const e=this.inputEl.value.trim();e.length&&"Enter"===t.key&&this.addTask(e)})),this.allBtns.forEach((t=>{t.addEventListener("click",(()=>this.setFilter("all")))})),this.activeBtns.forEach((t=>{t.addEventListener("click",(()=>this.setFilter("active")))})),this.completedBtns.forEach((t=>{t.addEventListener("click",(()=>this.setFilter("completed")))})),this.clearCompleteditemsBtn.addEventListener("click",(()=>{this.clearCompletedItems()})),this.loadTasks(),this.loadActiveFilter(),this.render()}addTask(t){const e={id:Date.now(),value:t,completed:!1};this.tasks.push(e),this.inputEl.value="",this.saveTasks(),this.render()}removeTask(t){this.tasks=this.tasks.filter((e=>e.id!==t)),this.saveTasks(),this.render()}toggleTaskCompletion(t){this.tasks=this.tasks.map((e=>e.id===t?Object.assign(Object.assign({},e),{completed:!e.completed}):e)),this.saveTasks(),this.render()}setFilter(t){this.filter=t,this.filterButtons.forEach((e=>{e.id===t?e.classList.add("active"):e.classList.remove("active")})),this.saveActiveFilter(),this.render()}getFilteredTasks(){switch(this.filter){case"active":return this.tasks.filter((t=>!t.completed));case"completed":return this.tasks.filter((t=>t.completed));default:return this.tasks}}updateLeftItems(){const t=this.tasks.filter((t=>!t.completed)).length;this.itemsLeftElement.textContent=`${t} items left`}clearCompletedItems(){this.tasks=this.tasks.filter((t=>!t.completed)),this.saveTasks(),this.render()}saveTasks(){t("tasks",this.tasks)}loadTasks(){const t=e("tasks");t&&(this.tasks=t)}saveActiveFilter(){t("active-category",this.filter)}loadActiveFilter(){const t=e("active-category");this.filter=t||"all",this.setFilter(this.filter)}render(){const t=this.getFilteredTasks();this.listEl.innerHTML="",0===t.length?this.notFound.classList.add("show"):(this.notFound.classList.remove("show"),t.forEach((t=>{const e=document.createElement("li");e.draggable=!0,e.classList.add("todo-item"),e.innerHTML=`\n                          <input class='circle' type="checkbox" ${t.completed?"checked":""}/>\n                          <span class="item">${t.value}</span>\n                   \n                      <button  class="remove-item">\n                          <img src="./images/icon-cross.svg" alt="Cross icon" />\n                      </button>`,e.querySelector("input").addEventListener("click",(()=>{this.toggleTaskCompletion(t.id)})),e.querySelector("button").addEventListener("click",(()=>{this.removeTask(t.id)})),e.addEventListener("dragstart",(e=>this.dragStartHandler(e,t.id))),e.addEventListener("drop",(e=>this.dropHandler(e,t.id))),e.addEventListener("dragover",(t=>this.dragOverHandler(t))),this.listEl.appendChild(e)}))),this.updateLeftItems()}dragStartHandler(t,e){var s;null===(s=t.dataTransfer)||void 0===s||s.setData("text/plain",`${e}`||""),t.dataTransfer.effectAllowed="move"}dropHandler(t,e){var s;t.preventDefault();const i=null===(s=t.dataTransfer)||void 0===s?void 0:s.getData("text/plain");if(i&&i!==e.toString()){const t=this.tasks.findIndex((t=>t.id.toString()===i)),s=this.tasks.findIndex((t=>t.id===e)),[a]=this.tasks.splice(t,1);this.tasks.splice(s,0,a),this.saveTasks(),this.render()}}dragOverHandler(t){t.preventDefault()}}class i{constructor(){this.targetElement=document.body,this.switchButton=this.targetElement.querySelector(".toggle-icon"),this.switchButton.addEventListener("click",(()=>{this.toggleTheme()})),this.loadTheme()}toggleTheme(){const e=this.targetElement.classList.toggle("dark-mode");t("theme",e?"dark":"light")}loadTheme(){"dark"===(e("theme")||"light")?this.targetElement.classList.add("dark-mode"):this.targetElement.classList.remove("dark-mode")}}document.addEventListener("DOMContentLoaded",(()=>{new s,new i}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q3hELGdCQUlBUyxLQUFLeUQsYUFBYXhELGlCQUFpQixTQUFTLEtBQzFDRCxLQUFLMEQsYUFBYSxJQUVwQjFELEtBQUsyRCxXQUNQLENBQ1EsV0FBQUQsR0FDTixNQUFNRSxFQUFTNUQsS0FBS3VELGNBQWMvQixVQUFVcUMsT0FBTyxhQUNuRDNGLEVBQW1CLFFBQVMwRixFQUFTLE9BQVMsUUFDaEQsQ0FDUSxTQUFBRCxHQUVhLFVBREFsRixFQUFxQixVQUFZLFNBRWxEdUIsS0FBS3VELGNBQWMvQixVQUFVQyxJQUFJLGFBRWpDekIsS0FBS3VELGNBQWMvQixVQUFVRSxPQUFPLFlBRXhDLEVDdEJGdEMsU0FBU2EsaUJBQWlCLG9CQUFvQixLQUM1QyxJQUFJckIsRUFDSixJQUFJMEUsQ0FBYSxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdG9kby1hcHAtbWFpbi8uL3NyYy91dGlscy9zdG9yYWdlLnRzIiwid2VicGFjazovL3RvZG8tYXBwLW1haW4vLi9zcmMvY29tcG9uZW50cy9Ub0RvQXBwLnRzIiwid2VicGFjazovL3RvZG8tYXBwLW1haW4vLi9zcmMvY29tcG9uZW50cy9Td2l0Y2hUaGVtZS50cyIsIndlYnBhY2s6Ly90b2RvLWFwcC1tYWluLy4vc3JjL2FwcC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3Qgc2F2ZVRvTG9jYWxTdG9yYWdlID0gKGtleTogc3RyaW5nLCBkYXRhOiBhbnkpID0+IHtcclxuICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBsb2FkRnJvbUxvY2FsU3RvcmFnZSA9IChrZXk6IHN0cmluZykgPT4ge1xyXG4gIGNvbnN0IGRhdGEgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpO1xyXG4gIHJldHVybiBkYXRhID8gSlNPTi5wYXJzZShkYXRhKSA6IG51bGw7XHJcbn07XHJcbiIsImltcG9ydCB7IFRhc2sgfSBmcm9tIFwiLi4vbW9kZWxzL1Rhc2tcIjtcclxuaW1wb3J0IHsgRmlsdGVyIH0gZnJvbSBcIi4uL21vZGVscy9GaWx0ZXJcIjtcclxuaW1wb3J0IHsgc2F2ZVRvTG9jYWxTdG9yYWdlLCBsb2FkRnJvbUxvY2FsU3RvcmFnZSB9IGZyb20gXCIuLi91dGlscy9zdG9yYWdlXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgVG9Eb0FwcCB7XHJcbiAgcHJpdmF0ZSB0YXNrczogVGFza1tdID0gW1xyXG4gICAgeyBpZDogMSwgdmFsdWU6IFwiUmVhZCBhIGJvb2tcIiwgY29tcGxldGVkOiBmYWxzZSB9LFxyXG4gICAgeyBpZDogMiwgdmFsdWU6IFwiMTAgbWludXRlcyBtZWRpdGF0aW9uXCIsIGNvbXBsZXRlZDogdHJ1ZSB9LFxyXG4gIF07XHJcbiAgcHJpdmF0ZSBmaWx0ZXI6IEZpbHRlciA9IFwiYWxsXCI7XHJcbiAgcHJpdmF0ZSBsaXN0RWw6IEhUTUxVTGlzdEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcclxuICAgIFwidG9Eb0xpc3RcIlxyXG4gICkhIGFzIEhUTUxVTGlzdEVsZW1lbnQ7XHJcbiAgcHJpdmF0ZSBub3RGb3VuZDogSFRNTERpdkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgXCIubm8taXRlbS1mb3VuZFwiXHJcbiAgKSEgYXMgSFRNTERpdkVsZW1lbnQ7XHJcbiAgcHJpdmF0ZSBpbnB1dEVsOiBIVE1MSW5wdXRFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXHJcbiAgICBcInRvZG9JbnB1dFwiXHJcbiAgKSEgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICBwcml2YXRlIGFsbEJ0bnM6IE5vZGVMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIiNhbGxcIikhIGFzIE5vZGVMaXN0O1xyXG4gIHByaXZhdGUgYWN0aXZlQnRuczogTm9kZUxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFxyXG4gICAgXCIjYWN0aXZlXCJcclxuICApISBhcyBOb2RlTGlzdDtcclxuICBwcml2YXRlIGNvbXBsZXRlZEJ0bnM6IE5vZGVMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcclxuICAgIFwiI2NvbXBsZXRlZFwiXHJcbiAgKSEgYXMgTm9kZUxpc3Q7XHJcbiAgcHJpdmF0ZSBmaWx0ZXJCdXR0b25zOiBOb2RlTGlzdE9mPEhUTUxFbGVtZW50PiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXHJcbiAgICBcIi5maWx0ZXItYnRuXCJcclxuICApIGFzIE5vZGVMaXN0T2Y8SFRNTEVsZW1lbnQ+O1xyXG4gIHByaXZhdGUgaXRlbXNMZWZ0RWxlbWVudDogSFRNTFNwYW5FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgIFwiLmxlZnQtaXRlbXNcIlxyXG4gICkgYXMgSFRNTFNwYW5FbGVtZW50O1xyXG4gIHByaXZhdGUgY2xlYXJDb21wbGV0ZWRpdGVtc0J0bjogSFRNTEJ1dHRvbkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgXCIuY2xlYXItY29tcGxldGVkLWl0ZW1zXCJcclxuICApIGFzIEhUTUxCdXR0b25FbGVtZW50O1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5pbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCAoZXZlbnQ6IEtleWJvYXJkRXZlbnQpID0+IHtcclxuICAgICAgY29uc3QgaW5wdXRWYWx1ZTogc3RyaW5nID0gdGhpcy5pbnB1dEVsLnZhbHVlLnRyaW0oKTtcclxuICAgICAgaWYgKGlucHV0VmFsdWUubGVuZ3RoICYmIGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XHJcbiAgICAgICAgdGhpcy5hZGRUYXNrKGlucHV0VmFsdWUpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHRoaXMuYWxsQnRucy5mb3JFYWNoKChlbCkgPT4ge1xyXG4gICAgICBlbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gdGhpcy5zZXRGaWx0ZXIoXCJhbGxcIikpO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLmFjdGl2ZUJ0bnMuZm9yRWFjaCgoZWwpID0+IHtcclxuICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuc2V0RmlsdGVyKFwiYWN0aXZlXCIpKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5jb21wbGV0ZWRCdG5zLmZvckVhY2goKGVsKSA9PiB7XHJcbiAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB0aGlzLnNldEZpbHRlcihcImNvbXBsZXRlZFwiKSk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuY2xlYXJDb21wbGV0ZWRpdGVtc0J0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICB0aGlzLmNsZWFyQ29tcGxldGVkSXRlbXMoKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5sb2FkVGFza3MoKTtcclxuICAgIHRoaXMubG9hZEFjdGl2ZUZpbHRlcigpO1xyXG4gICAgdGhpcy5yZW5kZXIoKTtcclxuICB9XHJcbiAgcHJpdmF0ZSBhZGRUYXNrKHZhbHVlOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIGNvbnN0IG5ld1Rhc2s6IFRhc2sgPSB7XHJcbiAgICAgIGlkOiBEYXRlLm5vdygpLFxyXG4gICAgICB2YWx1ZTogdmFsdWUsXHJcbiAgICAgIGNvbXBsZXRlZDogZmFsc2UsXHJcbiAgICB9O1xyXG4gICAgdGhpcy50YXNrcy5wdXNoKG5ld1Rhc2spO1xyXG4gICAgdGhpcy5pbnB1dEVsLnZhbHVlID0gXCJcIjtcclxuICAgIHRoaXMuc2F2ZVRhc2tzKCk7XHJcbiAgICB0aGlzLnJlbmRlcigpO1xyXG4gIH1cclxuICBwcml2YXRlIHJlbW92ZVRhc2soaWQ6IG51bWJlcik6IHZvaWQge1xyXG4gICAgdGhpcy50YXNrcyA9IHRoaXMudGFza3MuZmlsdGVyKCh0YXNrKSA9PiB0YXNrLmlkICE9PSBpZCk7XHJcbiAgICB0aGlzLnNhdmVUYXNrcygpO1xyXG4gICAgdGhpcy5yZW5kZXIoKTtcclxuICB9XHJcbiAgcHJpdmF0ZSB0b2dnbGVUYXNrQ29tcGxldGlvbihpZDogbnVtYmVyKTogdm9pZCB7XHJcbiAgICB0aGlzLnRhc2tzID0gdGhpcy50YXNrcy5tYXAoKHRhc2spID0+IHtcclxuICAgICAgaWYgKHRhc2suaWQgPT09IGlkKSB7XHJcbiAgICAgICAgcmV0dXJuIHsgLi4udGFzaywgY29tcGxldGVkOiAhdGFzay5jb21wbGV0ZWQgfTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gdGFzaztcclxuICAgIH0pO1xyXG4gICAgdGhpcy5zYXZlVGFza3MoKTtcclxuICAgIHRoaXMucmVuZGVyKCk7XHJcbiAgfVxyXG4gIHByaXZhdGUgc2V0RmlsdGVyKGZpbHRlcjogRmlsdGVyKTogdm9pZCB7XHJcbiAgICB0aGlzLmZpbHRlciA9IGZpbHRlcjtcclxuICAgIHRoaXMuZmlsdGVyQnV0dG9ucy5mb3JFYWNoKChidG4pID0+IHtcclxuICAgICAgaWYgKGJ0bi5pZCA9PT0gZmlsdGVyKSB7XHJcbiAgICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIik7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoXCJhY3RpdmVcIik7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgdGhpcy5zYXZlQWN0aXZlRmlsdGVyKCk7XHJcbiAgICB0aGlzLnJlbmRlcigpO1xyXG4gIH1cclxuICBwcml2YXRlIGdldEZpbHRlcmVkVGFza3MoKTogVGFza1tdIHtcclxuICAgIHN3aXRjaCAodGhpcy5maWx0ZXIpIHtcclxuICAgICAgY2FzZSBcImFjdGl2ZVwiOlxyXG4gICAgICAgIHJldHVybiB0aGlzLnRhc2tzLmZpbHRlcigodGFzaykgPT4gIXRhc2suY29tcGxldGVkKTtcclxuICAgICAgY2FzZSBcImNvbXBsZXRlZFwiOlxyXG4gICAgICAgIHJldHVybiB0aGlzLnRhc2tzLmZpbHRlcigodGFzaykgPT4gdGFzay5jb21wbGV0ZWQpO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHJldHVybiB0aGlzLnRhc2tzO1xyXG4gICAgfVxyXG4gIH1cclxuICBwcml2YXRlIHVwZGF0ZUxlZnRJdGVtcygpIHtcclxuICAgIGNvbnN0IGFjdGl2ZVRhc2tDb3VudCA9IHRoaXMudGFza3MuZmlsdGVyKCh0YXNrKSA9PiAhdGFzay5jb21wbGV0ZWQpLmxlbmd0aDtcclxuICAgIHRoaXMuaXRlbXNMZWZ0RWxlbWVudC50ZXh0Q29udGVudCA9IGAke2FjdGl2ZVRhc2tDb3VudH0gaXRlbXMgbGVmdGA7XHJcbiAgfVxyXG4gIHByaXZhdGUgY2xlYXJDb21wbGV0ZWRJdGVtcygpIHtcclxuICAgIHRoaXMudGFza3MgPSB0aGlzLnRhc2tzLmZpbHRlcigodGFzaykgPT4gIXRhc2suY29tcGxldGVkKTtcclxuICAgIHRoaXMuc2F2ZVRhc2tzKCk7XHJcbiAgICB0aGlzLnJlbmRlcigpO1xyXG4gIH1cclxuICBwcml2YXRlIHNhdmVUYXNrcygpOiB2b2lkIHtcclxuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInRhc2tzXCIsIHRoaXMudGFza3MpO1xyXG4gIH1cclxuICBwcml2YXRlIGxvYWRUYXNrcygpOiB2b2lkIHtcclxuICAgIGNvbnN0IHNhdmVkVGFza3MgPSBsb2FkRnJvbUxvY2FsU3RvcmFnZShcInRhc2tzXCIpO1xyXG4gICAgaWYgKHNhdmVkVGFza3MpIHtcclxuICAgICAgdGhpcy50YXNrcyA9IHNhdmVkVGFza3M7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHByaXZhdGUgc2F2ZUFjdGl2ZUZpbHRlcigpIHtcclxuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImFjdGl2ZS1jYXRlZ29yeVwiLCB0aGlzLmZpbHRlcik7XHJcbiAgfVxyXG4gIHByaXZhdGUgbG9hZEFjdGl2ZUZpbHRlcigpIHtcclxuICAgIGNvbnN0IHNhdmVkRmlsdGVyOiBGaWx0ZXIgPSBsb2FkRnJvbUxvY2FsU3RvcmFnZShcclxuICAgICAgXCJhY3RpdmUtY2F0ZWdvcnlcIlxyXG4gICAgKSBhcyBGaWx0ZXI7XHJcbiAgICB0aGlzLmZpbHRlciA9IHNhdmVkRmlsdGVyIHx8IFwiYWxsXCI7XHJcbiAgICB0aGlzLnNldEZpbHRlcih0aGlzLmZpbHRlcik7XHJcbiAgfVxyXG4gIHByaXZhdGUgcmVuZGVyKCk6IHZvaWQge1xyXG4gICAgY29uc3QgdGFza3MgPSB0aGlzLmdldEZpbHRlcmVkVGFza3MoKTtcclxuICAgIHRoaXMubGlzdEVsLmlubmVySFRNTCA9IFwiXCI7XHJcbiAgICBpZiAodGFza3MubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHRoaXMubm90Rm91bmQuY2xhc3NMaXN0LmFkZChcInNob3dcIik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLm5vdEZvdW5kLmNsYXNzTGlzdC5yZW1vdmUoXCJzaG93XCIpO1xyXG4gICAgICB0YXNrcy5mb3JFYWNoKCh0YXNrKSA9PiB7XHJcbiAgICAgICAgY29uc3QgdGFza0VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGlcIik7XHJcbiAgICAgICAgdGFza0VsZW1lbnQuZHJhZ2dhYmxlID0gdHJ1ZTtcclxuICAgICAgICB0YXNrRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidG9kby1pdGVtXCIpO1xyXG4gICAgICAgIHRhc2tFbGVtZW50LmlubmVySFRNTCA9IGBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgY2xhc3M9J2NpcmNsZScgdHlwZT1cImNoZWNrYm94XCIgJHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2suY29tcGxldGVkID8gXCJjaGVja2VkXCIgOiBcIlwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfS8+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJpdGVtXCI+JHt0YXNrLnZhbHVlfTwvc3Bhbj5cclxuICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiAgY2xhc3M9XCJyZW1vdmUtaXRlbVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIDxpbWcgc3JjPVwiLi9pbWFnZXMvaWNvbi1jcm9zcy5zdmdcIiBhbHQ9XCJDcm9zcyBpY29uXCIgLz5cclxuICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPmA7XHJcbiAgICAgICAgY29uc3QgY2hlY2tlZEJ0biA9IHRhc2tFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgICAgICBcImlucHV0XCJcclxuICAgICAgICApIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XHJcblxyXG4gICAgICAgIGNoZWNrZWRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgICAgIHRoaXMudG9nZ2xlVGFza0NvbXBsZXRpb24odGFzay5pZCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc3QgcmVtb3ZlQnRuID0gdGFza0VsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgICAgIFwiYnV0dG9uXCJcclxuICAgICAgICApIGFzIEhUTUxCdXR0b25FbGVtZW50O1xyXG4gICAgICAgIHJlbW92ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5yZW1vdmVUYXNrKHRhc2suaWQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vIERyYWcgZXZlbnQgbGlzdGVuZXJzXHJcbiAgICAgICAgdGFza0VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdzdGFydFwiLCAoZXZlbnQpID0+XHJcbiAgICAgICAgICB0aGlzLmRyYWdTdGFydEhhbmRsZXIoZXZlbnQsIHRhc2suaWQpXHJcbiAgICAgICAgKTtcclxuICAgICAgICB0YXNrRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZHJvcFwiLCAoZXZlbnQpID0+XHJcbiAgICAgICAgICB0aGlzLmRyb3BIYW5kbGVyKGV2ZW50LCB0YXNrLmlkKVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgdGFza0VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdvdmVyXCIsIChldmVudCkgPT5cclxuICAgICAgICAgIHRoaXMuZHJhZ092ZXJIYW5kbGVyKGV2ZW50KVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIHRoaXMubGlzdEVsLmFwcGVuZENoaWxkKHRhc2tFbGVtZW50KTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnVwZGF0ZUxlZnRJdGVtcygpO1xyXG4gIH1cclxuICAvLyAgIERyYWcgJiBEcm9wIGhhbmRsZXJzXHJcbiAgcHJpdmF0ZSBkcmFnU3RhcnRIYW5kbGVyKGV2ZW50OiBEcmFnRXZlbnQsIGlkOiBudW1iZXIpOiB2b2lkIHtcclxuICAgIGV2ZW50LmRhdGFUcmFuc2Zlcj8uc2V0RGF0YShcInRleHQvcGxhaW5cIiwgYCR7aWR9YCB8fCBcIlwiKTtcclxuICAgIGV2ZW50LmRhdGFUcmFuc2ZlciEuZWZmZWN0QWxsb3dlZCA9IFwibW92ZVwiO1xyXG4gIH1cclxuICBwcml2YXRlIGRyb3BIYW5kbGVyKGV2ZW50OiBEcmFnRXZlbnQsIGlkOiBudW1iZXIpOiB2b2lkIHtcclxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBjb25zdCBkcmFnZ2VkSWQgPSBldmVudC5kYXRhVHJhbnNmZXI/LmdldERhdGEoXCJ0ZXh0L3BsYWluXCIpO1xyXG5cclxuICAgIGlmIChkcmFnZ2VkSWQgJiYgZHJhZ2dlZElkICE9PSBpZC50b1N0cmluZygpKSB7XHJcbiAgICAgIGNvbnN0IGRyYWdnZWRJbmRleCA9IHRoaXMudGFza3MuZmluZEluZGV4KFxyXG4gICAgICAgICh0YXNrKSA9PiB0YXNrLmlkLnRvU3RyaW5nKCkgPT09IGRyYWdnZWRJZFxyXG4gICAgICApO1xyXG4gICAgICBjb25zdCB0YXJnZXRJbmRleCA9IHRoaXMudGFza3MuZmluZEluZGV4KCh0YXNrKSA9PiB0YXNrLmlkID09PSBpZCk7XHJcbiAgICAgIGNvbnN0IFtkcmFnZ2VkVGFza10gPSB0aGlzLnRhc2tzLnNwbGljZShkcmFnZ2VkSW5kZXgsIDEpO1xyXG4gICAgICB0aGlzLnRhc2tzLnNwbGljZSh0YXJnZXRJbmRleCwgMCwgZHJhZ2dlZFRhc2spO1xyXG5cclxuICAgICAgdGhpcy5zYXZlVGFza3MoKTtcclxuICAgICAgdGhpcy5yZW5kZXIoKTtcclxuICAgIH1cclxuICB9XHJcbiAgcHJpdmF0ZSBkcmFnT3ZlckhhbmRsZXIoZXZlbnQ6IERyYWdFdmVudCk6IHZvaWQge1xyXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IHsgc2F2ZVRvTG9jYWxTdG9yYWdlLCBsb2FkRnJvbUxvY2FsU3RvcmFnZSB9IGZyb20gXCIuLi91dGlscy9zdG9yYWdlXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgU3dpdGNoVGhlbWUge1xyXG4gIHByaXZhdGUgdGFyZ2V0RWxlbWVudDogSFRNTEJvZHlFbGVtZW50ID0gZG9jdW1lbnQuYm9keSEgYXMgSFRNTEJvZHlFbGVtZW50O1xyXG4gIHByaXZhdGUgc3dpdGNoQnV0dG9uOiBIVE1MRGl2RWxlbWVudCA9IHRoaXMudGFyZ2V0RWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgXCIudG9nZ2xlLWljb25cIlxyXG4gICkhIGFzIEhUTUxEaXZFbGVtZW50O1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMuc3dpdGNoQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgIHRoaXMudG9nZ2xlVGhlbWUoKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5sb2FkVGhlbWUoKTtcclxuICB9XHJcbiAgcHJpdmF0ZSB0b2dnbGVUaGVtZSgpIHtcclxuICAgIGNvbnN0IGlzRGFyayA9IHRoaXMudGFyZ2V0RWxlbWVudC5jbGFzc0xpc3QudG9nZ2xlKFwiZGFyay1tb2RlXCIpO1xyXG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwidGhlbWVcIiwgaXNEYXJrID8gXCJkYXJrXCIgOiBcImxpZ2h0XCIpO1xyXG4gIH1cclxuICBwcml2YXRlIGxvYWRUaGVtZSgpIHtcclxuICAgIGNvbnN0IHNhdmVkVGhlbWUgPSBsb2FkRnJvbUxvY2FsU3RvcmFnZShcInRoZW1lXCIpIHx8IFwibGlnaHRcIjtcclxuICAgIGlmIChzYXZlZFRoZW1lID09PSBcImRhcmtcIikge1xyXG4gICAgICB0aGlzLnRhcmdldEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImRhcmstbW9kZVwiKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMudGFyZ2V0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiZGFyay1tb2RlXCIpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgeyBUb0RvQXBwIH0gZnJvbSBcIi4vY29tcG9uZW50cy9Ub0RvQXBwXCI7XHJcbmltcG9ydCB7IFN3aXRjaFRoZW1lIH0gZnJvbSBcIi4vY29tcG9uZW50cy9Td2l0Y2hUaGVtZVwiO1xyXG5cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgKCkgPT4ge1xyXG4gIG5ldyBUb0RvQXBwKCk7XHJcbiAgbmV3IFN3aXRjaFRoZW1lKCk7XHJcbn0pO1xyXG4iXSwibmFtZXMiOlsic2F2ZVRvTG9jYWxTdG9yYWdlIiwia2V5IiwiZGF0YSIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJKU09OIiwic3RyaW5naWZ5IiwibG9hZEZyb21Mb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwicGFyc2UiLCJUb0RvQXBwIiwiY29uc3RydWN0b3IiLCJ0YXNrcyIsImlkIiwidmFsdWUiLCJjb21wbGV0ZWQiLCJmaWx0ZXIiLCJsaXN0RWwiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwibm90Rm91bmQiLCJxdWVyeVNlbGVjdG9yIiwiaW5wdXRFbCIsImFsbEJ0bnMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiYWN0aXZlQnRucyIsImNvbXBsZXRlZEJ0bnMiLCJmaWx0ZXJCdXR0b25zIiwiaXRlbXNMZWZ0RWxlbWVudCIsImNsZWFyQ29tcGxldGVkaXRlbXNCdG4iLCJ0aGlzIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiaW5wdXRWYWx1ZSIsInRyaW0iLCJsZW5ndGgiLCJhZGRUYXNrIiwiZm9yRWFjaCIsImVsIiwic2V0RmlsdGVyIiwiY2xlYXJDb21wbGV0ZWRJdGVtcyIsImxvYWRUYXNrcyIsImxvYWRBY3RpdmVGaWx0ZXIiLCJyZW5kZXIiLCJuZXdUYXNrIiwiRGF0ZSIsIm5vdyIsInB1c2giLCJzYXZlVGFza3MiLCJyZW1vdmVUYXNrIiwidGFzayIsInRvZ2dsZVRhc2tDb21wbGV0aW9uIiwibWFwIiwiYnRuIiwiY2xhc3NMaXN0IiwiYWRkIiwicmVtb3ZlIiwic2F2ZUFjdGl2ZUZpbHRlciIsImdldEZpbHRlcmVkVGFza3MiLCJ1cGRhdGVMZWZ0SXRlbXMiLCJhY3RpdmVUYXNrQ291bnQiLCJ0ZXh0Q29udGVudCIsInNhdmVkVGFza3MiLCJzYXZlZEZpbHRlciIsImlubmVySFRNTCIsInRhc2tFbGVtZW50IiwiY3JlYXRlRWxlbWVudCIsImRyYWdnYWJsZSIsImRyYWdTdGFydEhhbmRsZXIiLCJkcm9wSGFuZGxlciIsImRyYWdPdmVySGFuZGxlciIsImFwcGVuZENoaWxkIiwiZGF0YVRyYW5zZmVyIiwic2V0RGF0YSIsImVmZmVjdEFsbG93ZWQiLCJwcmV2ZW50RGVmYXVsdCIsImRyYWdnZWRJZCIsImdldERhdGEiLCJ0b1N0cmluZyIsImRyYWdnZWRJbmRleCIsImZpbmRJbmRleCIsInRhcmdldEluZGV4IiwiZHJhZ2dlZFRhc2siLCJzcGxpY2UiLCJTd2l0Y2hUaGVtZSIsInRhcmdldEVsZW1lbnQiLCJib2R5Iiwic3dpdGNoQnV0dG9uIiwidG9nZ2xlVGhlbWUiLCJsb2FkVGhlbWUiLCJpc0RhcmsiLCJ0b2dnbGUiXSwic291cmNlUm9vdCI6IiJ9